{% extends "landingPage\page.html" %}
{% block title %}
    <title>{{service_name}}文档 | Azure</title>
{% endblock %}

{% block header %}
    <link rel="stylesheet" type="text/css" href="{{cssLink}}" />
    <script type="text/javascript" src="{{jqueryLink}}"></script>
    <script type="text/javascript" src="{{jsLink}}"></script>
{% endblock %}

{% block content %}
    <script>
        amp.options.flashSS.swf = "http://amp.azure.net/libs/amp/1.1.1/techs/StrobeMediaPlayback.2.0.swf";
        amp.options.flashSS.plugin = "http://amp.azure.net/libs/amp/1.1.1/techs/MSAdaptiveStreamingPlugin-osmf2.0.swf";
        amp.options.silverlightSS.xap = "http://amp.azure.net/libs/amp/1.1.1/techs/SmoothStreamingPlayer.xap";
        var navigationJsonStr = '{% autoescape off %}{{navigationJson}}{% endautoescape %}'
		var activeActicleId = null;
        var pageId = null;
        var textareanotclosed = 0;
        function renderNavigation(navigationJsonStr, activeActicleId) {
            navigationJson = JSON.parse(navigationJsonStr);
            mainDiv = document.getElementById("wa-navigationLeft");

            serviceTitle = document.createElement("a");
            serviceTitle.id = navigationJson.id;
            serviceTitle.innerHTML = navigationJson.service;
            serviceTitle.className = "toggler";
            editButt = document.createElement("a");
            editButt.href = "javascript:editField('"+serviceTitle.id+"', 'text')";
            editButt.title = "编辑";
            editImage = document.createElement("img");
            editImage.src = "/static/landingPage/img/edit.png";
            editImage.style = "width:20px;height:20px;margin-bottom:0px";
            editButt.appendChild(editImage);
            serviceTitle.appendChild(editButt);
            mainDiv.appendChild(serviceTitle);

            mainUl = document.createElement("ul");
            mainUl.className = "toggled";
            mainDiv.appendChild(mainUl);

            for (var i = 0; i < navigationJson.navigation.length; i++) {
                groupLi = document.createElement("li");
                groupLi.id = navigationJson.navigation[i].id + "_header";
                groupLi.setAttribute("data-control", "toggle");
                groupLi.setAttribute("data-tag-name", navigationJson.navigation[i].id);
                groupLi.setAttribute("data-service-name", navigationJson.id);
                mainUl.appendChild(groupLi);
                groupTitle = document.createElement("a");
                groupTitle.setAttribute("onclick", "show('" + navigationJson.navigation[i].id + "_header" + "')");
                groupTitle.innerHTML = navigationJson.navigation[i].group;
                groupTitle.className = "toggler";
                groupTitle.id = navigationJson.navigation[i].id + "_group_title";
                editButt = document.createElement("a");
                editButt.href = "javascript:editField('"+groupTitle.id+"', 'text')";
                editButt.title = "编辑";
                editButt.addEventListener("click", function(e){
                    if ( e && e.stopPropagation ) 
                        e.stopPropagation(); 
                    else
                        window.event.cancelBubble = true; 
                });
                editImage = document.createElement("img");
                editImage.src = "/static/landingPage/img/edit.png";
                editImage.setAttribute("style", "width:20px;height:20px;margin-bottom:0px");
                editButt.appendChild(editImage);
                groupTitle.appendChild(editButt);
                deleteButt = document.createElement("a");
                deleteButt.href = "javascript:deleteField('"+groupLi.id+"')";
                deleteButt.title = "删除";
                deleteButt.addEventListener("click", function(e){
                    if ( e && e.stopPropagation ) 
                        e.stopPropagation(); 
                    else
                        window.event.cancelBubble = true; 
                });
                deleteImage = document.createElement("img");
                deleteImage.setAttribute("style", "width:20px;height:20px;margin-bottom:0px");
                deleteImage.src = "/static/landingPage/img/delete.png";
                deleteButt.appendChild(deleteImage);
                groupTitle.appendChild(deleteButt);
                moveUpButt = document.createElement("a");
                moveUpButt.href = "javascript:moveUpField('"+groupLi.id+"')";
                moveUpButt.title = "上移";
                moveUpButt.addEventListener("click", function(e){
                    if ( e && e.stopPropagation ) 
                        e.stopPropagation(); 
                    else
                        window.event.cancelBubble = true; 
                });
                moveUpImage = document.createElement("img");
                moveUpImage.setAttribute("style", "width:20px;height:20px;margin-bottom:0px");
                moveUpImage.src = "/static/landingPage/img/moveUp.png";
                moveUpButt.appendChild(moveUpImage);
                groupTitle.appendChild(moveUpButt);
                moveDownButt = document.createElement("a");
                moveDownButt.href = "javascript:moveDownField('"+groupLi.id+"')";
                moveDownButt.title = "下移";
                moveDownButt.addEventListener("click", function(e){
                    if ( e && e.stopPropagation ) 
                        e.stopPropagation(); 
                    else
                        window.event.cancelBubble = true; 
                });
                moveDownImage = document.createElement("img");
                moveDownImage.setAttribute("style", "width:20px;height:20px;margin-bottom:0px");
                moveDownImage.src = "/static/landingPage/img/moveDown.png";
                moveDownButt.appendChild(moveDownImage);
                groupTitle.appendChild(moveDownButt);
                groupLi.appendChild(groupTitle);
                groupUl = document.createElement("ul");
                groupUl.id = navigationJson.navigation[i].id;
                groupUl.className = "toggled";
                groupLi.appendChild(groupUl);
                for (var j = 0; j < navigationJson.navigation[i].articles.length; j++) {
                    articleLi = document.createElement("li");
                    articleLi.id = navigationJson.navigation[i].articles[j].id+"_li"
                    groupUl.appendChild(articleLi);
                    articleLink = document.createElement("a");
                    articleLink.href = navigationJson.navigation[i].articles[j].link;
                    articleLink.innerHTML = navigationJson.navigation[i].articles[j].title;
                    articleLink.id = navigationJson.navigation[i].articles[j].id;
                    articleLink.setAttribute("data-link-service-name", navigationJson.id);
                    articleLink.setAttribute("data-link-tag-name", navigationJson.navigation[i].articles[j].id);
                    editButt = document.createElement("a");
                    editButt.href = "javascript:editField('"+articleLink.id+"', 'link')";
                    editButt.addEventListener("click", function(e){
                        if ( e && e.stopPropagation ) 
                            e.stopPropagation(); 
                        else
                            window.event.cancelBubble = true; 
                    });
                    editButt.title = "编辑";
                    editImage = document.createElement("img");
                    editImage.src = "/static/landingPage/img/edit.png";
                    editImage.setAttribute("style", "width:20px;height:20px;margin-bottom:0px");
                    editButt.appendChild(editImage);
                    articleLink.appendChild(editButt);
                    deleteButt = document.createElement("a");
                    deleteButt.href = "javascript:deleteField('"+articleLi.id+"')";
                    deleteButt.title = "删除";
                    deleteButt.addEventListener("click", function(e){
                        if ( e && e.stopPropagation ) 
                            e.stopPropagation(); 
                        else
                            window.event.cancelBubble = true; 
                    });
                    deleteImage = document.createElement("img");
                    deleteImage.src = "/static/landingPage/img/delete.png";
                    deleteImage.setAttribute("style", "width:20px;height:20px;margin-bottom:0px");
                    deleteButt.appendChild(deleteImage);
                    articleLink.appendChild(deleteButt);
                    moveUpButt = document.createElement("a");
                    moveUpButt.href = "javascript:moveUpField('"+articleLi.id+"')";
                    moveUpButt.title = "上移";
                    moveUpButt.addEventListener("click", function(e){
                        if ( e && e.stopPropagation ) 
                            e.stopPropagation(); 
                        else
                            window.event.cancelBubble = true; 
                    });
                    moveUpImage = document.createElement("img");
                    moveUpImage.src = "/static/landingPage/img/moveUp.png";
                    moveUpImage.setAttribute("style", "width:20px;height:20px;margin-bottom:0px");
                    moveUpButt.appendChild(moveUpImage);
                    articleLink.appendChild(moveUpButt);
                    moveDownButt = document.createElement("a");
                    moveDownButt.href = "javascript:moveDownField('"+articleLi.id+"')";
                    moveDownButt.title = "下移";
                    moveDownButt.addEventListener("click", function(e){
                        if ( e && e.stopPropagation ) 
                            e.stopPropagation(); 
                        else
                            window.event.cancelBubble = true; 
                    });
                    moveDownImage = document.createElement("img");
                    moveDownImage.src = "/static/landingPage/img/moveDown.png";
                    moveDownImage.setAttribute("style", "width:20px;height:20px;margin-bottom:0px");
                    moveDownButt.appendChild(moveDownImage);
                    articleLink.appendChild(moveDownButt);
                    articleLi.appendChild(articleLink);
                }
                addli = document.createElement("li");
                addli.name = "addNavigationLink";
                addLink = document.createElement("input");
                addLink.type = "button";
                addLink.setAttribute("onclick", "addNavigationLink(this)");
                addLink.value = "添加链接";
                addli.appendChild(addLink);
                groupUl.appendChild(addli);
            }
            if (activeActicleId == null) {
                document.getElementById(navigationJson.navigation[0].id + "_header").className = "active open";
                pageId = navigationJson.navigation[0].id + "_header";
            }
            else {
                for (var i = 0; i < navigationJson.navigation.length; i++) {
                    for (var j = 0; j < navigationJson.navigation[i].articles.length; j++) {
                        if (navigationJson.navigation[i].articles[j].id == activeActicleId) {
                            document.getElementById(navigationJson.navigation[i].id + "_header").className = "active open";
                            pageId = navigationJson.navigation[i].id + "_header";
                            document.getElementById(activeActicleId).style.color = "#00abec";
                            break;
                        }
                    }
                }
            }
            addli = document.createElement("li");
            addli.name = "addNavigationGroup";
            addGroupLink = document.createElement("input");
            addGroupLink.type = "button";
            addGroupLink.setAttribute("onclick", "addNavigationGroup(this)");
            addGroupLink.value = "添加组";
            addli.appendChild(addGroupLink);
            mainUl.appendChild(addli);
        }

        var newGroupCount = {{newGroupCount}};
        function addNavigationGroup(addGroup){
            mainUl = addGroup.parentNode.parentNode;
            groupLi = document.createElement("li");
            groupLi.id = "new_group_header"+newGroupCount;
            groupLi.setAttribute("data-control", "toggle");
            groupLi.setAttribute("data-tag-name", "new_group"+newGroupCount);
            groupLi.setAttribute("data-service-name", navigationJson.id);
            mainUl.insertBefore(groupLi, addGroup.parentNode);
            groupTitle = document.createElement("a");
            groupTitle.setAttribute("onclick", "show('new_group_header" + newGroupCount + "')");
            groupTitle.innerHTML = "请输入";
            groupTitle.className = "toggler";
            groupTitle.id = "new_group_title"+newGroupCount;
            editButt = document.createElement("a");
            editButt.href = "javascript:editField('"+groupTitle.id+"', 'text')";
            editButt.title = "编辑";
            editButt.addEventListener("click", function(e){
                if ( e && e.stopPropagation ) 
                    e.stopPropagation(); 
                else
                    window.event.cancelBubble = true; 
            });
            editImage = document.createElement("img");
            editImage.src = "/static/landingPage/img/edit.png";
            editImage.setAttribute("style", "width:20px;height:20px;margin-bottom:0px");
            editButt.appendChild(editImage);
            groupTitle.appendChild(editButt);
            deleteButt = document.createElement("a");
            deleteButt.href = "javascript:deleteField('"+groupLi.id+"')";
            deleteButt.title = "删除";
            deleteButt.addEventListener("click", function(e){
                if ( e && e.stopPropagation ) 
                    e.stopPropagation(); 
                else
                    window.event.cancelBubble = true; 
            });
            deleteImage = document.createElement("img");
            deleteImage.setAttribute("style", "width:20px;height:20px;margin-bottom:0px");
            deleteImage.src = "/static/landingPage/img/delete.png";
            deleteButt.appendChild(deleteImage);
            groupTitle.appendChild(deleteButt);
            moveUpButt = document.createElement("a");
            moveUpButt.href = "javascript:moveUpField('"+groupLi.id+"')";
            moveUpButt.title = "上移";
            moveUpButt.addEventListener("click", function(e){
                if ( e && e.stopPropagation ) 
                    e.stopPropagation(); 
                else
                    window.event.cancelBubble = true; 
            });
            moveUpImage = document.createElement("img");
            moveUpImage.setAttribute("style", "width:20px;height:20px;margin-bottom:0px");
            moveUpImage.src = "/static/landingPage/img/moveUp.png";
            moveUpButt.appendChild(moveUpImage);
            groupTitle.appendChild(moveUpButt);
            moveDownButt = document.createElement("a");
            moveDownButt.href = "javascript:moveDownField('"+groupLi.id+"')";
            moveDownButt.title = "下移";
            moveDownButt.addEventListener("click", function(e){
                if ( e && e.stopPropagation ) 
                    e.stopPropagation(); 
                else
                    window.event.cancelBubble = true; 
            });
            moveDownImage = document.createElement("img");
            moveDownImage.setAttribute("style", "width:20px;height:20px;margin-bottom:0px");
            moveDownImage.src = "/static/landingPage/img/moveDown.png";
            moveDownButt.appendChild(moveDownImage);
            groupTitle.appendChild(moveDownButt);
            groupLi.appendChild(groupTitle);
            groupUl = document.createElement("ul");
            groupUl.id = "new_group"+newGroupCount;
            groupUl.className = "toggled";
            groupLi.appendChild(groupUl);
            addli = document.createElement("li");
            addli.name = "addNavigationLink";
            addLink = document.createElement("input");
            addLink.type = "button";
            addLink.setAttribute("onclick", "addNavigationLink(this)");
            addLink.value = "添加链接";
            addli.appendChild(addLink);
            groupUl.appendChild(addli);
            newGroupCount++;
        }

        var newLinkCount = {{newLinkCount}};
        function addNavigationLink(addLink){
            groupUl = addLink.parentNode.parentNode;
        
            articleLi = document.createElement("li");
            articleLi.id = "newLink_li"+newLinkCount;
            groupUl.insertBefore(articleLi, addLink.parentNode);
            articleLink = document.createElement("a");
            articleLink.href = "#";
            
            articleLink.innerHTML = "请输入";
            articleLink.id = "newLink"+newLinkCount;
            articleLink.setAttribute("data-link-service-name", groupUl.parentNode.getAttribute("data-service-name"));
            articleLink.setAttribute("data-link-tag-name", "newLink"+newLinkCount);
            editButt = document.createElement("a");
            editButt.href = "javascript:editField('"+articleLink.id+"', 'link')";
            editButt.addEventListener("click", function(e){
                if ( e && e.stopPropagation ) 
                    e.stopPropagation(); 
                else
                    window.event.cancelBubble = true; 
            });
            editButt.title = "编辑";
            editImage = document.createElement("img");
            editImage.src = "/static/landingPage/img/edit.png";
            editImage.setAttribute("style", "width:20px;height:20px;margin-bottom:0px");
            editButt.appendChild(editImage);
            articleLink.appendChild(editButt);
            deleteButt = document.createElement("a");
            deleteButt.href = "javascript:deleteField('"+articleLi.id+"')";
            deleteButt.title = "删除";
            deleteButt.addEventListener("click", function(e){
                if ( e && e.stopPropagation ) 
                    e.stopPropagation(); 
                else
                    window.event.cancelBubble = true; 
            });
            deleteImage = document.createElement("img");
            deleteImage.src = "/static/landingPage/img/delete.png";
            deleteImage.setAttribute("style", "width:20px;height:20px;margin-bottom:0px");
            deleteButt.appendChild(deleteImage);
            articleLink.appendChild(deleteButt);
            moveUpButt = document.createElement("a");
            moveUpButt.href = "javascript:moveUpField('"+articleLi.id+"')";
            moveUpButt.title = "上移";
            moveUpButt.addEventListener("click", function(e){
                if ( e && e.stopPropagation ) 
                    e.stopPropagation(); 
                else
                    window.event.cancelBubble = true; 
            });
            moveUpImage = document.createElement("img");
            moveUpImage.src = "/static/landingPage/img/moveUp.png";
            moveUpImage.setAttribute("style", "width:20px;height:20px;margin-bottom:0px");
            moveUpButt.appendChild(moveUpImage);
            articleLink.appendChild(moveUpButt);
            moveDownButt = document.createElement("a");
            moveDownButt.href = "javascript:moveDownField('"+articleLi.id+"')";
            moveDownButt.title = "下移";
            moveDownButt.addEventListener("click", function(e){
                if ( e && e.stopPropagation ) 
                    e.stopPropagation(); 
                else
                    window.event.cancelBubble = true; 
            });
            moveDownImage = document.createElement("img");
            moveDownImage.src = "/static/landingPage/img/moveDown.png";
            moveDownImage.setAttribute("style", "width:20px;height:20px;margin-bottom:0px");
            moveDownButt.appendChild(moveDownImage);
            articleLink.appendChild(moveDownButt);
            articleLi.appendChild(articleLink);
            newLinkCount++;
        }

        function dropdownSelectChange() {
            dropdownSelect = document.getElementById('dropdown-cta');
            contentSelected = document.getElementById('wa-dropdown-value');
            document.getElementById('wa-button-link').href = dropdownSelect.value;
            contentSelected.innerHTML = dropdownSelect.options[dropdownSelect.selectedIndex].innerHTML;
        }

        // show article-content when click on link
        $(function () {
            $(".wa-arrowLink.wa-arrowLink-blue").click(function () {
                $(this).attr('style', 'display:none');
                $(this).siblings(".article-content").removeAttr('style');
            });
        });
        
        var recentUpdateCount = {{recentUpdates|length}};
        String.prototype.replaceAll = function(target, replacement) {
            return this.split(target).join(replacement);
        };

        var newUpdateTemplate = '<div class="wa-serviceUpdate">\n<h4 id="edit_recent_title@@counter@@"><textarea style="width:85%;" placeholder="请输入更新的标题"></textarea>\n<a title="编辑" href="javascript:editField(\'edit_recent_title@@counter@@\', \'text\')">\n<img style="width:20px;height:20px;margin-bottom:0px" src="/static/landingPage/img/edit.png">\n</a>\n<a title="删除" href="javascript:deleteField(\'edit_recent_update@@counter@@\')">\n<img style="width:20px;height:20px;margin-bottom:0px" src="/static/landingPage/img/delete.png">\n</a>\n</h4>\n<p class="article-date" id="edit_recent_date@@counter@@"><textarea style="width:85%;" placeholder="请输入更新的日期， 如：2015年03月31日"></textarea>\n<a title="编辑" href="javascript:editField(\'edit_recent_date@@counter@@\', \'text\')">\n<img style="width:20px;height:20px;margin-bottom:0px" src="/static/landingPage/img/edit.png">\n</a>\n</p>\n<p id="edit_recent_description@@counter@@"><textarea style="width:85%;" placeholder="请输入更新的描述"></textarea>\n<a title="编辑" href="javascript:editField(\'edit_recent_description@@counter@@\', \'text\')">\n<img style="width:20px;height:20px;margin-bottom:0px" src="/static/landingPage/img/edit.png">\n</a>\n</p>\n<p class="article-content" id="edit_recent_detail@@counter@@"><textarea style="width:85%;" placeholder="请输入更新的细节"></textarea>\n<a title="编辑" href="javascript:editField(\'edit_recent_detail@@counter@@\', \'text\')">\n<img style="width:20px;height:20px;margin-bottom:0px" src="/static/landingPage/img/edit.png">\n</a>\n</p>\n<a class="wa-arrowLink wa-arrowLink-blue" style="display:none" href="javascript:void(0);">了解更多</a>\n</div>'
        function addNewUpdate(){
            textareanotclosed+=4;
            addRecentUpdate = document.getElementById("add_new_update");
            newRecentUpdate = document.createElement("div");
            newRecentUpdate.className = "wa-content wa-content-3up";
            newRecentUpdate.id = "edit_recent_update"+(recentUpdateCount+1);
            newRecentUpdate.innerHTML = newUpdateTemplate.replaceAll("@@counter@@", recentUpdateCount+1);
            insertAfter(newRecentUpdate, addRecentUpdate);
            element = document.getElementById("edit_recent_title"+(recentUpdateCount+1));

            textArea = element.getElementsByTagName("textarea")[0];
            editting["edit_recent_title"+(recentUpdateCount+1)] = {"element":element, "textField": textArea, "text":document.createTextNode("")};

            element = document.getElementById("edit_recent_date"+(recentUpdateCount+1));
            textArea = element.getElementsByTagName("textarea")[0];
            editting["edit_recent_date"+(recentUpdateCount+1)] = {"element":element, "textField": textArea, "text":document.createTextNode("")};

            element = document.getElementById("edit_recent_description"+(recentUpdateCount+1));
            textArea = element.getElementsByTagName("textarea")[0];
            editting["edit_recent_description"+(recentUpdateCount+1)] = {"element":element, "textField": textArea, "text":document.createTextNode("")};

            element = document.getElementById("edit_recent_detail"+(recentUpdateCount+1));
            textArea = element.getElementsByTagName("textarea")[0];
            editting["edit_recent_detail"+(recentUpdateCount+1)] = {"element":element, "textField": textArea, "text":document.createTextNode("")};
            recentUpdateCount++;
        }
        function insertAfter(newNode, referenceNode) {
            referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);
        }
        var tutorialOptionCount = {{options|length}};
        var newTutorialOptionTemplate = '<textarea placeholder="请输入教程标题"></textarea>\n<textarea placeholder="请输入教程链接"></textarea>\n<a href="javascript:deleteField(\'edit_option_@@counter@@\')" title="删除">\n<img src="/static/landingPage/img/delete.png" style="width:20px;height:20px;margin-bottom:0px"/>\n</a>'
        function addTutorialOption(id){
            textareanotclosed+=2;
                    editSelectList = document.createElement("div");
                    editSelectList.id = "edit_option_"+(tutorialOptionCount+1);
                    editSelectList.innerHTML = newTutorialOptionTemplate.replace("@@counter@@", tutorialOptionCount+1);
                    addButt = document.getElementById(id);
                    addButt.parentElement.insertBefore(editSelectList, addButt);
                    tutorialOptionCount++;
        }
    </script>
    <script>
        var editting = {};
        function editField(id, type) {
            element = document.getElementById(id);
            if(type == "text"){
                if(!editting[id]){
                    textareanotclosed++;
                    textField = document.createElement("textarea");
                    textField.addEventListener("click", function(e){
                        if ( e && e.stopPropagation ) 
                            e.stopPropagation(); 
                        else
                            window.event.cancelBubble = true; 
                    });
                    textField.setAttribute("style","width:85%;")
                    as = element.getElementsByTagName("a");
                    clone_e = [];
                    edit_butt = null;
                    delete_butt = null;
                    moveUp_butt = null;
                    moveDown_butt = null;
                    for (var i = 0; i<as.length; i++){
                        if(as[i].title.trim()=="编辑"){
                            clonedNode = as[i].cloneNode(true);
                            clonedNode.addEventListener("click", function(e){
                                if ( e && e.stopPropagation ) 
                                    e.stopPropagation(); 
                                else
                                    window.event.cancelBubble = true; 
                            });
                            clone_e.push(clonedNode);
                            edit_butt = as[i];
                        }
                        if(as[i].title.trim()=="删除"){
                            clonedNode = as[i].cloneNode(true);
                            clonedNode.addEventListener("click", function(e){
                                if ( e && e.stopPropagation ) 
                                    e.stopPropagation(); 
                                else
                                    window.event.cancelBubble = true; 
                            });
                            clone_e.push(clonedNode);
                            delete_butt = as[i];
                        }
                        if(as[i].title.trim()=="上移"){
                            clonedNode = as[i].cloneNode(true);
                            clonedNode.addEventListener("click", function(e){
                                if ( e && e.stopPropagation ) 
                                    e.stopPropagation(); 
                                else
                                    window.event.cancelBubble = true; 
                            });
                            clone_e.push(clonedNode);
                            moveUp_butt = as[i];
                        }
                        if(as[i].title.trim()=="下移"){
                            clonedNode = as[i].cloneNode(true);
                            clonedNode.addEventListener("click", function(e){
                                if ( e && e.stopPropagation ) 
                                    e.stopPropagation(); 
                                else
                                    window.event.cancelBubble = true; 
                            });
                            clone_e.push(clonedNode);
                            moveDown_butt = as[i];
                        }
                    }
                    if(edit_butt!=null)
                        element.removeChild(edit_butt);
                    if(delete_butt!=null)
                        element.removeChild(delete_butt);
                    if(moveUp_butt!=null)
                        element.removeChild(moveUp_butt);
                    if(moveDown_butt!=null)
                        element.removeChild(moveDown_butt);
                    textField.value = element.innerHTML.trim();
                    element.innerHTML = "";
                    element.appendChild(textField);
                    for(var i=0; i<clone_e.length; i++)
                        element.appendChild(clone_e[i]);
                    editting[id] = true;
                }
                else{
                    nodeValue = element.getElementsByTagName("textarea")[0].value;
                    element.removeChild(element.getElementsByTagName("textarea")[0]);
                    element.innerHTML = nodeValue+element.innerHTML;
                    as = element.getElementsByTagName("a");
                    for (var i = 0; i<as.length; i++){
                        as[i].addEventListener("click", function(e){
                            if ( e && e.stopPropagation ) 
                                e.stopPropagation(); 
                            else
                                window.event.cancelBubble = true; 
                        });
                    }
                    textareanotclosed--;
                    editting[id] = false;
                }
            }
            else if(type == "link"){
                if(!editting[id]){
                    textareanotclosed+=2;
                    container = document.createElement("span");
                    textField1 = document.createElement("textarea");
                    textField1.setAttribute("style","width:85%;")
                    textField2 = document.createElement("textarea");
                    textField2.setAttribute("style","width:85%;")
                    for (var i = 0; i<element.childNodes.length; i++){
                        if(element.childNodes[i].nodeValue!=null && element.childNodes[i].nodeValue.trim()!=""){
                            textField1.value = element.childNodes[i].nodeValue.trim();
                            textField2.value = element.href;
                            editting[id]={"element":element, "container":container, "title":textField1, "link":textField2, "text":element.childNodes[i]}
                            container.appendChild(textField1);
                            container.appendChild(textField2);
                            element.parentElement.insertBefore(container, element);
                            element.childNodes[i].nodeValue = "";
                            break
                        }
                    }
                    
                }
                else{
                    textareanotclosed-=2;
                    editting[id].element.tagName = "a";
                    editting[id].text.nodeValue = editting[id].title.value;
                    editting[id].element.href = editting[id].link.value
                    editting[id].container.parentElement.replaceChild(editting[id].element, editting[id].container);
                    editting[id] = false;
                }
            }
            else if(type == "select_list"){
                if(!editting[id]){
                    editSelectList = document.getElementById("editSelectList");
                    editSelectList.style.display = "block";
                    edit_tutorial_select_list = document.getElementById("edit_tutorial_select_list");
                    textareanotclosed += edit_tutorial_select_list.getElementsByTagName("option").length*2;
                    edit_tutorial_select_list.style.display = "none";
                    editting[id] = true;
                }
                else{
                    editSelectList = document.getElementById("editSelectList");
                    editSelectList.style.display = "none";
                    edit_tutorial_select_list = document.getElementById("edit_tutorial_select_list");
                    edit_tutorial_select_list.style.display = "";
                    options_div = editSelectList.getElementsByTagName("div");
                    select_list = document.getElementById("dropdown-cta");
                    textareanotclosed-=options_div.length*2;
                    while (select_list.firstChild) {
                        select_list.removeChild(select_list.firstChild);
                    }

                    for(i=0; i<options_div.length; i++){
                        textAreas = options_div[i].getElementsByTagName("textarea");
                        title = textAreas[0].value;
                        link = textAreas[1].value;
                        option = document.createElement("option");
                        option.innerHTML = title;
                        option.value = link;
                        select_list.appendChild(option);
                    }
                    
                    document.getElementById("wa-dropdown-value").innerHTML = options_div[0].getElementsByTagName("textarea")[0].value;
                    document.getElementById("wa-button-link").href = options_div[0].getElementsByTagName("textarea")[1].value;
                    editting[id] = false;
                }
            }
            else if(type == "video"){
                if(!editting[id]){
                    textareanotclosed+=5;
                    edit_video = document.getElementById(id);
                    edit_video.style.display = "none";
                    des_edit_video = document.getElementById("des_"+id);
                    des_edit_video.style.display = "none";
                    edit_video_fields = document.getElementById("video_editing_"+id.substring(10, id.length));
                    edit_video_fields.style.display = "block";
                    editting[id] = true;
                }
                else{
                    textareanotclosed-=5;
                    link = document.getElementById(id);
                    thumbnail = link.getElementsByClassName("thumbnail")[0];
                    dateAndDuration = link.getElementsByClassName("date")[0].getElementsByTagName("span");
                    descr = document.getElementById("des_"+id);
                    video_counter_str = id.substring(10, id.length);
                    link.href = document.getElementById("video_url_"+video_counter_str).value;
                    dateAndDuration[1].innerHTML = document.getElementById("video_publishDate_"+video_counter_str).value;
                    link.title = document.getElementById("video_title_"+video_counter_str).value;
                    dateAndDuration[0].innerHTML = document.getElementById("video_duration_"+video_counter_str).value;
                    thumbnail.src = "{{imgLink}}" + document.getElementById("uploaded_images"+video_counter_str).value;
                    descr.innerHTML = document.getElementById("video_description_"+video_counter_str).value;
                    link.style.display = "block";
                    descr.style.display = "block";
                    document.getElementById("video_editing_"+id.substring(10, id.length)).style.display = "none";
                    editting[id] = false;
                }
            }
        }
        function deleteField(id){
            element = document.getElementById(id);
            textareaChild = element.getElementsByTagName("textarea");
            textareanotclosed-=textareaChild.length;
            element.parentElement.removeChild(element);
            if(id.indexOf("edit_video_full")>-1){
                video_block = id.replace("edit_video_full", "edit_video");
                if(!editting[video_block]){
                    textareanotclosed+=textareaChild.length;
                }
                if(video_count==3){
                    document.getElementById("edit_video_add").style.display="block";
                }
                video_count--;
                
            }
        }

        function moveUpField(id){
            element = document.getElementById(id);
            index = -1;
            for(i=0; i<element.parentElement.childNodes.length-1; i++){
                if(element.parentElement.childNodes[i].id == id){
                    index = i;
                    break;
                }
            }
            if(index == 0 || index == -1){
                alert("cannot move up");
            }
            else{
                element.parentElement.insertBefore(element, element.parentElement.childNodes[i-1]);
            }
        }
        function moveDownField(id){
            element = document.getElementById(id);
            
            index = -1;
            for(i=0; i<element.parentElement.childNodes.length-1; i++){
                if(element.parentElement.childNodes[i].id == id){
                    index = i;
                    break;
                }
            }
            
            if(index == element.parentElement.childNodes.length-2 || index == -1){
                alert("cannot move down");
            }
            else{
                element.parentElement.insertBefore(element, element.parentElement.childNodes[i+2]);
            }
        }

        var video_count = {{videoLinks|length }};
        var next_video = {{videoLinks|length }};
        function add_video(){
            textareanotclosed+=5;
            edit_video_add = document.getElementById("edit_video_add");
            div = document.createElement("div");
            div.className = "wa-spacer";
            div.id = "edit_video_full"+(next_video+1);
            editting["edit_video"+(next_video+1)] = true;
            next_video++;
            video_count++;
            edit_video_add.parentElement.insertBefore(div, edit_video_add);
            if(video_count>=3){
                edit_video_add.style.display="none";
            }
            var xmlhttp;
            if (window.XMLHttpRequest)
            {
                xmlhttp=new XMLHttpRequest();
            }
            else
            {
                xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
            }
            xmlhttp.onreadystatechange = function () {
                if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                    div.innerHTML = xmlhttp.responseText
                    document.getElementById("cover").style.display = "none";
                }
            }
            xmlhttp.open("GET", "/landingpage/uploadimage/{{service_id}}/"+next_video, true);
            xmlhttp.send();
            document.getElementById("cover").style.display = "block";
        }
        
        function submitPage(){
            if(textareanotclosed!=0){
                alert("TextArea not closed");
                return false;
            }
            send_content = new Object();
            send_content.navigation = getNavigationJsonStr();
            send_content.content = getContentJsonStr();
            send_content.recentUpdate = getRecentUpdateJsonStr();
            send_content.meta = getMetaJsonStr();
            send_content.tutorialOptions = getTutorialOptionsJson();
            send_content.videoLink = getVideoLinkJson();
            document.getElementById("wholeJson").value = JSON.stringify(send_content);
            document.getElementById("newGroupCount").value = newGroupCount;
            document.getElementById("newLinkCount").value = newLinkCount;
            document.getElementById("cover").style.display = "block";
            return true;
        }

        function getVideoLinkJson(){
            videoLinkJson = [];
            for(i=1; i<=next_video; i++){
                title = document.getElementById("video_title_"+i);
                if(title != null){
                    video = new Object();
                    video.Title = title.value;
                    video.ImageUrl = document.getElementById("uploaded_images"+i).value;
                    video.VideoUrl = document.getElementById("video_url_"+i).value;
                    video.Description = document.getElementById("video_description_"+i).value;
                    video.PublishTime = document.getElementById("video_publishDate_"+i).value;
                    video.Duration = document.getElementById("video_duration_"+i).value;
                    videoLinkJson.push(video);
                }
            }
            return videoLinkJson;
        }

        function getTutorialOptionsJson(){
            tutorialOptionsJson = [];
            selectList = document.getElementById("dropdown-cta");
            for(i=0; i<selectList.options.length; i++){
                option = new Object();
                option.title = selectList.options[i].textContent.trim()
                option.link = selectList.options[i].value;
                tutorialOptionsJson.push(option)
            }
            return tutorialOptionsJson;
        }

        function getMetaJsonStr(){
            metaJson = new Object();
            metaJson.metat_keywords = document.getElementById("metat_keywords").textContent.trim();
            metaJson.meta_description = document.getElementById("meta_description").textContent.trim();
            return metaJson;
        }

        function getRecentUpdateJsonStr(){
            recentUpdateJson = [];
            for(i=1; i<=recentUpdateCount; i++){
                try{
                    update = new Object();
                    update.update_title = document.getElementById("edit_recent_title"+i).textContent.trim();
                    edit_recent_description = document.getElementById("edit_recent_description"+i);
                    update_detail = document.getElementById("edit_recent_detail"+i);
                    as = edit_recent_description.getElementsByTagName("a");
                    for(j=0; j<=as.length; j++){
                        if(as[j].title=="编辑"){
                            edit_recent_description.removeChild(as[j]);
                            break;
                        }
                    }
                    as = update_detail.getElementsByTagName("a");
                    for(j=0; j<=as.length; j++){
                        if(as[j].title=="编辑"){
                            update_detail.removeChild(as[j]);
                            break;
                        }
                    }
                    update.update_description = edit_recent_description.innerHTML.trim();
                    update.update_date = document.getElementById("edit_recent_date"+i).textContent.trim();
                    update.update_detail = update_detail.innerHTML.trim();
                    update.link = "#";
                    recentUpdateJson.push(update);
                }
                catch(e){
                
                }
            }
            return recentUpdateJson;
        }

        function getContentJsonStr(){
            contentJson = new Object();
            edit_subtitle = document.getElementById("edit_subtitle");
            edit_tutorial_message =  document.getElementById("edit_tutorial_message");
            as = edit_subtitle.getElementsByTagName("a");
            for(j=0; j<=as.length; j++){
                if(as[j].title=="编辑"){
                    edit_subtitle.removeChild(as[j]);
                    break;
                }
            }
            as = edit_tutorial_message.getElementsByTagName("a");
            for(j=0; j<=as.length; j++){
                if(as[j].title=="编辑"){
                    edit_tutorial_message.removeChild(as[j]);
                    break;
                }
            }
            contentJson.subtitle = edit_subtitle.innerHTML.trim();
            contentJson.tutorial_message =  edit_tutorial_message.innerHTML.trim();
            contentJson.update_search_links = "/what-is-new/";
            return contentJson;
        }

        function getNavigationJsonStr(){
            navigation = document.getElementById("wa-navigationLeft");
            rootTag = navigation.getElementsByTagName("a")[0];
            navigationJson = new Object();
            navigationJson.id = rootTag.id;
            navigationJson.service = rootTag.textContent.trim();
            ulTag = navigation.getElementsByTagName("ul")[0];
            navigationJson.navigation = [];
            
            for(i=0; i<ulTag.childNodes.length; i++){
                if(ulTag.childNodes[i].name == "addNavigationGroup"){
                    continue;
                }
                group = new Object();
                group.id = ulTag.childNodes[i].getAttribute("data-tag-name");
                group.group = ulTag.childNodes[i].getElementsByTagName("a")[0].textContent.trim();
                group.articles = [];
                articleUlTag = ulTag.childNodes[i].getElementsByTagName("ul")[0];
                for(j=0; j<articleUlTag.childNodes.length; j++){
                    if(articleUlTag.childNodes[j].name == "addNavigationLink")
                        continue;
                    article = new Object();
                    aTag = articleUlTag.childNodes[j].getElementsByTagName("a")[0];
                    article.id = aTag.id;
                    article.link = aTag.href;
                    article.title = aTag.textContent.trim();
                    group.articles.push(article);
                }
                navigationJson.navigation.push(group);
            }
            return navigationJson;
        }

        function metaEditField(){
            meta_data_fields = document.getElementById("mata_data_editing");
            if(meta_data_fields.style.display == "none"){
                meta_data_fields.style.display = "block";
                textareanotclosed = true;
            }
            else{
                meta_data_fields.style.display = "none";
                textareanotclosed = false;
            }
        }
    </script>
    <script>
        function viewSelectedImage(i) {
            selectList = document.getElementById("uploaded_images"+i);
            imageViewer = document.getElementById("imageViewer"+i);
            imageViewer.src = "{{imgLink2}}" + selectList.value;
        }
    </script>
    <style>
        .old-main-container {
            width: 100% !important;
            padding: 20px 0px !important;
        }
    </style>
    <div class="wa-container-documentation wa-container-nested-documentation">
        <section class="wa-section wa-section-micro">
            <div class="wa-content wa-content-documentation wa-content-4up">
                <div class="wa-spacer wa-spacer-docSide">
                    <div id="wa-navigationLeft" class="wa-navigationLeft" data-control="toggle">

                    </div>
                    <script>
                        renderNavigation(navigationJsonStr, activeActicleId);
                    </script>
                </div>
                <div class="wa-spacer wa-spacer-3down wa-spacer-docContent">
                    <div class="wa-content">
                        <h1>
                            {{service_name}}文档
                            <a href="javascript:metaEditField()" title="编辑">
                                <img src="/static/landingPage/img/edit.png" style="width:20px;height:20px;margin-bottom:0px"/>
                            </a>
                        </h1>
                        <div id="mata_data_editing" style="display:none">
                            <div>
                                <div>关键字</div><textarea id="metat_keywords" style="width:85%">{{metaKeywords}}</textarea>
                            </div>
                            <div>
                                <div>描述</div><textarea id="meta_description" style="width:85%">{{metaDescription}}</textarea>
                            </div>
                        </div>
                        {% autoescape off %}
                        <h5 id="edit_subtitle">
                            {{subtitle}}
                            <a href="javascript:editField('edit_subtitle', 'text')" title="编辑">
                                <img src="/static/landingPage/img/edit.png" style="width:20px;height:20px;margin-bottom:0px"/>
                            </a>
                        </h5>
                        <label for="dropdown-cta" class="wa-dropdown-label" id="edit_tutorial_message">
                            {{tutorial_message}}
                            <a href="javascript:editField('edit_tutorial_message', 'text')" title="编辑">
                                <img src="/static/landingPage/img/edit.png" style="width:20px;height:20px;margin-bottom:0px"/>
                            </a>
                        </label>
                        {% endautoescape %}
                            <div style="display:none" id="editSelectList">
                                {% for option in options %}
                                <div id="edit_option_{{forloop.counter}}">
                                    <textarea >{{option.title}}</textarea>
                                    <textarea >{{option.link}}</textarea>
                                    <a href="javascript:deleteField('edit_option_{{forloop.counter}}')" title="删除">
                                        <img src="/static/landingPage/img/delete.png" style="width:20px;height:20px;margin-bottom:0px"/>
                                    </a>
                                </div>
                                {% endfor %}
                                <span id="add_option_butt">
                                    <a href="javascript:addTutorialOption('add_option_butt')">增加选项</a>
                                </span>
                            </div>
                            <div class="wa-dropdown-container wa-dropdown-medium" id="edit_tutorial_select_list">
                                <select id="dropdown-cta" class="wa-dropdown" data-control="dropdown dropdown-linker" data-linker="cta" onchange="dropdownSelectChange()">
                                    {% for option in options %}
                                    <option value="{{option.link}}">
                                        {{option.title}}
                                    </option>
                                    {% endfor %}
                                </select>
                                <script>
                                checkDropdownMenuHasMoreThanOneOption();
                                </script>
                                <span id="wa-dropdown-value" class="wa-dropdown-value">{{first_option_title}}</span><span class="wa-dropdown-arrow"></span>
                            </div>
                            <a href="javascript:editField('edit_tutorial_select_list', 'select_list')" title="编辑">
                                <img src="/static/landingPage/img/edit.png" style="width:20px;height:20px;margin-bottom:0px"/>
                            </a>
                            <a id="wa-button-link" data-service-name="virtual-machines" href="{{first_option_link}}" class="wa-button wa-button-primary wa-button-mini" data-linker="cta">入门教程</a>
                    </div>
                    <div class="wa-content wa-content-divided sub-hero-heading">
                        <h2>
                            {{service_name}}视频
                        </h2>
                    </div>
                    <div class="wa-content wa-content-3up" id="video_container">
                        {% for videoLink in videoLinks%}
                            <div class="wa-spacer" id="edit_video_full{{forloop.counter}}">
                                <a  id="edit_video{{forloop.counter}}" href="{{videoLink.video_url}}" data-control="" data-expanding="false" class="wa-video-thumbnail _storage-video-popup" title="{{videoLink.title}}">
                                    <img src="{{imgLink2}}{{videoLink.image_title}}" alt="{{videoLink.title}}" class="thumbnail" />
                                    {% if azure %}
                                    <img class="play-icon" src="{{imgLink}}VideoPlay.png" />
                                    {% else %}
                                    <img class="play-icon" src="{{imgLink}}VideoPlay.svg" />
                                    {% endif %}
                                    <span class="metadata">
                                        <span class="date">
                                            <span>{{videoLink.publish_time}}</span>
                                            <span>{{videoLink.duration}}</span>
                                        </span>
                                    </span>
                                </a>
                                <p  id="des_edit_video{{forloop.counter}}">
                                    {{videoLink.description}}
                                </p>
                                <div id="video_editing_{{forloop.counter}}" style="display:none">
                                    <div>
                                        <div>标题</div><textarea style="width:300px;height:20px" id="video_title_{{forloop.counter}}">{{videoLink.title}}</textarea>
                                    </div>
                                    <div>
                                        <div>缩略图</div>
                                        <select id="uploaded_images{{forloop.counter}}" onchange="viewSelectedImage({{forloop.counter}})" value="{{videoLink.image_title}}">
    {% for image in images %}
    <option {% ifequal image videoLink.image_title %} selected {% endifequal %}>{{ image }}</option>
    {% endfor %}
</select>
<br/>
<img id="imageViewer{{forloop.counter}}" src="{{imgLink2}}{{ videoLink.image_title }}" width="300"/>
<form action="{% url "uploadimage" service_id forloop.counter %}" method="post" enctype="multipart/form-data">
    <p>{{ form.non_field_errors }}</p>

    <p>{{ form.docfile.label_tag }} {{ form.docfile.help_text }}</p>

    <p>
        {{ form.docfile.errors }}
        {{ form.docfile }}
    </p>

    <p><input type="submit" value="Upload"/></p>
</form>
                                    </div>
                                    <div>
                                        <div>链接</div><textarea style="width:300px" id="video_url_{{forloop.counter}}">{{videoLink.video_url}}</textarea>
                                    </div>
                                    <div>
                                        <div>描述</div><textarea style="width:300px" id="video_description_{{forloop.counter}}">{{videoLink.description}}</textarea>
                                    </div>
                                    <div>
                                        <div>发布时间</div><textarea style="width:300px" id="video_publishDate_{{forloop.counter}}">{{videoLink.publish_time}}</textarea>
                                    </div>
                                    <div>
                                        <div>时长</div><textarea style="width:300px" id="video_duration_{{forloop.counter}}">{{videoLink.duration}}</textarea>
                                    </div>
                                </div>
                                <a href="javascript:editField('edit_video{{forloop.counter}}', 'video')" title="编辑">
                                    <img src="/static/landingPage/img/edit.png" style="width:20px;height:20px;margin-bottom:0px"/>
                                </a>
                                <a href="javascript:deleteField('edit_video_full{{forloop.counter}}')" title="删除">
                                        <img src="/static/landingPage/img/delete.png" style="width:20px;height:20px;margin-bottom:0px"/>
                                    </a>
                                
                            </div>
                            
                        {% endfor %}
                            <div class="wa-spacer" id="edit_video_add" {% if videoLinks|length >= 3 %} style="display:none" {% endif %}>
                                <a href="javascript:add_video()" title="增加视频">
                                    <img src="{{imgLink}}add-icon-614x460.png" alt="增加视频" class="thumbnail" />
                                </a>
                                <p>
                                </p>
                            </div>
                    </div>
                    <div class="wa-content">
                        <a href="/video-center/" class="wa-arrowLink">观看更多视频</a>
                    </div>
                    <div class="wa-content wa-content-divided">
                        <h2>
                            {{service_name}}服务更新 <a href=""><span class="wa-icon wa-icon-misc-rss"></span></a>
                        </h2>
                    </div>
                    <div class="wa-content wa-content-3up">
                        <div class="wa-content wa-content-3up" id="add_new_update">
                            <a href="javascript:addNewUpdate()">增加更新</a>
                        </div>
                    {% for recent in recentUpdates %}
                        <div class="wa-content wa-content-3up" id="edit_recent_update{{forloop.revcounter}}">
                            <div class="wa-serviceUpdate">
                                <h4 id="edit_recent_title{{forloop.revcounter}}">
                                    {{recent.title}}
                                    <a href="javascript:editField('edit_recent_title{{forloop.revcounter}}', 'text')" title="编辑">
                                        <img src="/static/landingPage/img/edit.png" style="width:20px;height:20px;margin-bottom:0px"/>
                                    </a>
                                    <a href="javascript:deleteField('edit_recent_update{{forloop.revcounter}}')" title="删除">
                                        <img src="/static/landingPage/img/delete.png" style="width:20px;height:20px;margin-bottom:0px"/>
                                    </a>
                                </h4>
                                <p class="article-date" id="edit_recent_date{{forloop.revcounter}}">
                                    {{recent.date}}
                                    <a href="javascript:editField('edit_recent_date{{forloop.revcounter}}', 'text')" title="编辑">
                                        <img src="/static/landingPage/img/edit.png" style="width:20px;height:20px;margin-bottom:0px"/>
                                    </a>
                                </p>
                                {% autoescape off %}
                                <p id="edit_recent_description{{forloop.revcounter}}">
                                    {{recent.description}}
                                    <a href="javascript:editField('edit_recent_description{{forloop.revcounter}}', 'text')" title="编辑">
                                        <img src="/static/landingPage/img/edit.png" style="width:20px;height:20px;margin-bottom:0px"/>
                                    </a>
                                </p>
                                <p class="article-content" style="display:none"  id="edit_recent_detail{{forloop.revcounter}}">
                                    {{recent.detail}}
                                    <a href="javascript:editField('edit_recent_detail{{forloop.revcounter}}', 'text')" title="编辑">
                                        <img src="/static/landingPage/img/edit.png" style="width:20px;height:20px;margin-bottom:0px"/>
                                    </a>
                                </p>
                                {% endautoescape %}
                                <a class="wa-arrowLink wa-arrowLink-blue" href="javascript:void(0);">了解更多</a>
                            </div>
                            <a href=""></a>
                        </div>
                    {% endfor %}
                        
                    </div>
                    <div class="wa-content">
                        <a href="{{update_search_link}}" class="wa-arrowLink">查看更多服务更新</a>
                    </div>
                </div>
            </div>
        </section>
        <form method="post" action="{% url 'submitpage' service_id %}" onsubmit="return submitPage();">
            {% csrf_token %}
            <input type="hidden" id="wholeJson" name="wholeJson" value="" />
            <input type="hidden" id="service_id" name="service_id" value="{{service_id}}"/>
            <input type="hidden" id="newGroupCount" name="newGroupCount" value="">
            <input type="hidden" id="newLinkCount" name="newLinkCount" value="">
            <div style="float:right;">
                <input type="submit" value="保存" />
            </div>
        </form>
        <style>
#cover {
   position: fixed;
   padding:0;
   margin:0;
   top:0;
   left:0;
   width: 100%;
   height: 100%;
   opacity: 0.80;
   background: #aaa;
   z-index: 12;
   display:none;
}
        </style>
    </div>
<div id="cover">updating...</div>

{% endblock %}